% ---------- functions ----------
%
% Public, document-facing commands used by the resume sections.
% Base commands do NOT force a line break; *line variants do.


% ---- contact info line ----
% Usage:
% \contactinfo{ \contactentry{...}{...}, \contactentry{...}{...}, ... }
% Output: entry1 | entry2 | entry3   (with consistent spacing)

\ExplSyntaxOn

\seq_new:N \l__cv_contact_seq
\tl_new:N  \l__cv_contact_item_tl

\NewDocumentCommand{\contactentry}{m m}{%
  \linkplain{#1}{#2}%
}

\NewDocumentCommand{\contactinfo}{m}
  { \__cv_contactinfo:n { #1 } }

\cs_new_protected:Npn \__cv_contactinfo:n #1
  {
    \seq_clear:N \l__cv_contact_seq

    % Split on commas, trim items, drop empties
    \clist_map_inline:nn { #1 }
      {
        \tl_set:Nn \l__cv_contact_item_tl { ##1 }
        \tl_trim_spaces:N \l__cv_contact_item_tl

        \tl_if_blank:VTF \l__cv_contact_item_tl
          { }
          { \seq_put_right:NV \l__cv_contact_seq \l__cv_contact_item_tl }
      }

    % Join with a consistent separator and spacing
    \seq_use:Nn \l__cv_contact_seq { ~|~ }
  }

\NewDocumentCommand{\contactlink}{m}{%
  \str_case:nnF { #1 }
    {
      { email }    { \linkplain{\email}{mailto:\email} }
      { linkedin } { \linkplain{linkedin.com/in/\linkedin}{https://linkedin.com/in/\linkedin} }
      { github }   { \linkplain{github.com/\github}{https://github.com/\github} }
      { location } { \location }
    }
    { \textbf{?? Invalid contact type `#1` ??} }
}

\NewDocumentCommand{\github}{m m}{%
  \linkplain{#1}{https://github.com/\github/#2}%
}

\ExplSyntaxOff

% ---- job entry ----
% \job[seniority][role]{profession}{Company}{City, ST}{YYYY/MM/DD}{YYYY/MM/DD|present}
% \jobline... same output, but ends with \\ for one-entry-per-line usage.
\ExplSyntaxOn

\NewDocumentCommand{\role}{m}{%
  \tl_if_blank:nF {#1} {~--~{\em #1}}%
}

\NewDocumentCommand{\joblocation}{m}{%
  ~--~#1%
}

\NewDocumentCommand{\jobdates}{m m}{%
  \hfill \dateMY{#1}~--~\dateMY{#2}%
}

\NewDocumentCommand{\job}{o o m m m m m}{%
  \textbf{\IfValueT{#1}{#1~}#3 @~#4}%
  \role{\IfValueTF{#2}{#2}{}}%
  \joblocation{#5}%
  \jobdates{#6}{#7}\\%
}

\ExplSyntaxOff

% ---- credential id ----
% \id{00000}
% \id{00000}[https://url.com]
\NewDocumentCommand{\id}{m o}{%
  ID~\IfValueTF{#2}{\linkplain{#1}{#2}}{#1}%
}

% ---- credential entries ----
% \credential[prefix][id][url]{issuer}{title}{date}
\NewDocumentCommand{\credential}{o o o m m m}{%
  \textbf{#4}%
  \IfValueT{#1}{~--~#1:~}#5%
  \IfValueT{#2}{~(\IfValueTF{#3}{\id{#2}[#3]}{\id{#2}})}%
  \hfill \dateMY{#6}\\%
}

% \education[id][url]{issuer}{title}{date}
\NewDocumentCommand{\education}{o o m m m}{%
  \credential[][#1][#2]{#3}{#4}{#5}%
}

% \certification[id][url]{issuer}{title}{date}
\NewDocumentCommand{\certification}{o o m m m}{%
  \credential[Certification][#1][#2]{#3}{#4}{#5}%
}

% \license[id][url]{issuer}{title}{date}
\NewDocumentCommand{\license}{o o m m m}{%
  \credential[License][#1][#2]{#3}{#4}{#5}%
}

% ---- skill entries ----
% \skill{Title}{arg1, arg2, ..., argn}
\ExplSyntaxOn

\seq_new:N \l__cv_skill_seq
\tl_new:N  \l__cv_skill_item_tl

\NewDocumentCommand{\skill}{o m}
  { \__cv_skill_render:nO { #2 } #1\\ }

\cs_new_protected:Npn \__cv_skill_render:nO #1 #2
  {
    \seq_clear:N \l__cv_skill_seq

    % Split list on commas, trim each item, drop empties
    \clist_map_inline:nn { #1 }
      {
        \tl_set:Nn \l__cv_skill_item_tl { ##1 }
        \tl_trim_spaces:N \l__cv_skill_item_tl

        \tl_if_blank:VTF \l__cv_skill_item_tl
          { }% blank -> ignore
          { \seq_put_right:NV \l__cv_skill_seq \l__cv_skill_item_tl }
      }

    % Only print if at least one item exists
    \seq_if_empty:NF \l__cv_skill_seq
      {
        \IfValueT{#2}{\textbf{#2:}~}\seq_use:Nn \l__cv_skill_seq { ,~ }
      }
  }

\ExplSyntaxOff
